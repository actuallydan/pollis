<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Completing Authentication...</title>
	<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
	<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
	<style>body{font-family:system-ui;text-align:center;padding:50px;background:#111;color:#fbbf24;margin:0}h1{font-size:24px;margin-bottom:20px}#status{font-size:16px}.error{color:#ef4444}</style>
</head>
<body>
	<h1>Completing authentication...</h1>
	<p id="status">Loading...</p>
	<script async src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@5/dist/clerk.browser.js" crossorigin></script>
	<script>
		(async()=>{
			try{
				const s=document.getElementById('status'),
					  p='{{.PublishableKey}}',
					  c='{{.CallbackURL}}';
				s.textContent='Loading Clerk SDK...';

				// Wait for Clerk SDK to load (script tag above loads async)
				let i=0;
				while(!window.Clerk&&i++<100)await new Promise(r=>setTimeout(r,50));
				if(!window.Clerk)throw new Error('Clerk SDK not available');

				s.textContent='Initializing...';
				const clerk=new window.Clerk(p);
				await clerk.load();

				s.textContent='Getting token...';
				if(!clerk.session)throw new Error('No session found');

				const t=await clerk.session.getToken();
				if(!t)throw new Error('Failed to get token');

				s.textContent='Redirecting...';
				location.replace(c+'&token='+encodeURIComponent(t));
			}catch(e){
				console.error('Auth error:',e);
				const s=document.getElementById('status');
				s.textContent='Error: '+e.message;
				s.className='error';
			}
		})();
	</script>
</body>
</html>
